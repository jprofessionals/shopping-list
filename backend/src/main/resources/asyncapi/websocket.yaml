asyncapi: 2.6.0
info:
  title: Shopping List WebSocket API
  version: 1.0.0
  description: Real-time events for shopping list updates

servers:
  development:
    url: ws://localhost:8080/ws
    protocol: ws
    description: Development WebSocket server

channels:
  /:
    publish:
      summary: Commands sent by client
      message:
        oneOf:
          - $ref: '#/components/messages/SubscribeCommand'
          - $ref: '#/components/messages/UnsubscribeCommand'
          - $ref: '#/components/messages/PingCommand'
    subscribe:
      summary: Events received by client
      message:
        oneOf:
          - $ref: '#/components/messages/ItemAddedEvent'
          - $ref: '#/components/messages/ItemUpdatedEvent'
          - $ref: '#/components/messages/ItemCheckedEvent'
          - $ref: '#/components/messages/ItemRemovedEvent'
          - $ref: '#/components/messages/ListUpdatedEvent'
          - $ref: '#/components/messages/ListDeletedEvent'
          - $ref: '#/components/messages/SubscribedEvent'
          - $ref: '#/components/messages/UnsubscribedEvent'
          - $ref: '#/components/messages/PongEvent'
          - $ref: '#/components/messages/ErrorEvent'

components:
  messages:
    SubscribeCommand:
      payload:
        type: object
        properties:
          type:
            type: string
            const: subscribe
          listIds:
            type: array
            items:
              type: string
              format: uuid

    UnsubscribeCommand:
      payload:
        type: object
        properties:
          type:
            type: string
            const: unsubscribe
          listIds:
            type: array
            items:
              type: string
              format: uuid

    PingCommand:
      payload:
        type: object
        properties:
          type:
            type: string
            const: ping

    ItemAddedEvent:
      payload:
        type: object
        properties:
          type:
            type: string
            const: item:added
          listId:
            type: string
            format: uuid
          item:
            $ref: '#/components/schemas/ItemData'
          actor:
            $ref: '#/components/schemas/ActorInfo'
          timestamp:
            type: string
            format: date-time

    ItemUpdatedEvent:
      payload:
        type: object
        properties:
          type:
            type: string
            const: item:updated
          listId:
            type: string
            format: uuid
          item:
            $ref: '#/components/schemas/ItemData'
          changes:
            type: array
            items:
              type: string
          actor:
            $ref: '#/components/schemas/ActorInfo'
          timestamp:
            type: string
            format: date-time

    ItemCheckedEvent:
      payload:
        type: object
        properties:
          type:
            type: string
            const: item:checked
          listId:
            type: string
            format: uuid
          itemId:
            type: string
            format: uuid
          isChecked:
            type: boolean
          actor:
            $ref: '#/components/schemas/ActorInfo'
          timestamp:
            type: string
            format: date-time

    ItemRemovedEvent:
      payload:
        type: object
        properties:
          type:
            type: string
            const: item:removed
          listId:
            type: string
            format: uuid
          itemId:
            type: string
            format: uuid
          actor:
            $ref: '#/components/schemas/ActorInfo'
          timestamp:
            type: string
            format: date-time

    ListUpdatedEvent:
      payload:
        type: object
        properties:
          type:
            type: string
            const: list:updated
          list:
            $ref: '#/components/schemas/ListData'
          changes:
            type: array
            items:
              type: string
          actor:
            $ref: '#/components/schemas/ActorInfo'
          timestamp:
            type: string
            format: date-time

    ListDeletedEvent:
      payload:
        type: object
        properties:
          type:
            type: string
            const: list:deleted
          listId:
            type: string
            format: uuid
          actor:
            $ref: '#/components/schemas/ActorInfo'
          timestamp:
            type: string
            format: date-time

    SubscribedEvent:
      payload:
        type: object
        properties:
          type:
            type: string
            const: subscribed
          listIds:
            type: array
            items:
              type: string
              format: uuid

    UnsubscribedEvent:
      payload:
        type: object
        properties:
          type:
            type: string
            const: unsubscribed
          listIds:
            type: array
            items:
              type: string
              format: uuid

    PongEvent:
      payload:
        type: object
        properties:
          type:
            type: string
            const: pong

    ErrorEvent:
      payload:
        type: object
        properties:
          type:
            type: string
            const: error
          message:
            type: string
          code:
            type: string

  schemas:
    ItemData:
      type: object
      properties:
        id:
          type: string
          format: uuid
        name:
          type: string
        quantity:
          type: number
        unit:
          type: string
          nullable: true
        isChecked:
          type: boolean
        checkedByName:
          type: string
          nullable: true

    ListData:
      type: object
      properties:
        id:
          type: string
          format: uuid
        name:
          type: string
        householdId:
          type: string
          format: uuid
          nullable: true
        isPersonal:
          type: boolean

    ActorInfo:
      type: object
      properties:
        id:
          type: string
          format: uuid
        displayName:
          type: string
